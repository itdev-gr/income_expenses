---
import type { Transaction } from '../lib/types';
import { formatDate } from '../lib/dates';

interface Props {
	transactions: Transaction[];
	categories: Map<string, string>;
	userEmails: Map<string, string>;
}

const { transactions, categories, userEmails } = Astro.props;

function formatCurrency(cents: number): string {
	return new Intl.NumberFormat('en-US', {
		style: 'currency',
		currency: 'EUR',
	}).format(cents / 100);
}
---

<div class="bg-white rounded-lg shadow overflow-hidden">
	<table class="min-w-full divide-y divide-gray-200">
		<thead class="bg-gray-50">
			<tr>
				<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
				<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Type</th>
				<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Category</th>
				<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Amount</th>
				<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Note</th>
				<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Created By</th>
				<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
			</tr>
		</thead>
		<tbody class="bg-white divide-y divide-gray-200">
			{transactions.length === 0 ? (
				<tr>
					<td colspan="7" class="px-6 py-4 text-center text-gray-500">No transactions found</td>
				</tr>
			) : (
				transactions.map(tx => (
					<tr>
						<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{formatDate(tx.ts)}</td>
						<td class="px-6 py-4 whitespace-nowrap">
							<span class={`px-2 py-1 text-xs rounded-full ${
								tx.type === 'income' 
									? 'bg-green-100 text-green-800' 
									: 'bg-red-100 text-red-800'
							}`}>
								{tx.type}
							</span>
						</td>
						<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
							{categories.get(tx.categoryId) || 'Unknown'}
						</td>
						<td class={`px-6 py-4 whitespace-nowrap text-sm font-medium ${
							tx.type === 'income' ? 'text-green-600' : 'text-red-600'
						}`}>
							{formatCurrency(tx.amountCents)}
						</td>
						<td class="px-6 py-4 text-sm text-gray-500">{tx.note || '-'}</td>
						<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
							{userEmails.get(tx.createdBy) || tx.createdBy}
						</td>
						<td class="px-6 py-4 whitespace-nowrap text-sm">
							<form method="POST" action={`/transactions/${tx.id}/delete`} class="inline">
								<button
									type="submit"
									onclick="return confirm('Are you sure you want to delete this transaction?')"
									class="text-red-600 hover:text-red-900"
								>
									Delete
								</button>
							</form>
						</td>
					</tr>
				))
			)}
		</tbody>
	</table>
</div>
